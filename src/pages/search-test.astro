---
import { getCollection } from 'astro:content';
import videoData from "../content/blog/videoData.json";

// è·å–æœç´¢å‚æ•°
const searchQuery = Astro.url.searchParams.get('search') || 'OGSM';

// è·å–æ‰€æœ‰ Markdown æ–‡ç« 
const markdownArticles = await getCollection('blog');

// å¤„ç† Markdown æ–‡ç« æ•°æ®
const allArticles = markdownArticles.map(article => ({
  ...article,
  title: article.data.title,
  summary: article.data.summary,
  author: article.data.author,
  pubDate: article.data.pubDate,
  tags: article.data.tags,
  type: article.data.type,
  featured: article.data.featured || false,
  link: `/blog/${article.slug}`,
  contentType: 'markdown',
  isExternal: false,
  description: article.data.summary
}));

// å¤„ç†è§†é¢‘æ•°æ®
const allVideos = videoData.featuredVideos.map(video => ({
  ...video,
  type: 'Video',
  contentType: 'youtube',
  pubDate: video.publishDate,
  author: 'Spark Liang',
  featured: false,
  link: `https://www.youtube.com/watch?v=${video.videoId}`,
  isExternal: true,
  summary: video.description
}));

// åˆå¹¶æ‰€æœ‰å†…å®¹
const allContent = [...allArticles, ...allVideos];

// æœç´¢è¿‡æ»¤
const filteredContent = allContent.filter(item => {
  const query = searchQuery.toLowerCase();
  const titleMatch = item.title.toLowerCase().includes(query);
  const summaryMatch = item.summary && item.summary.toLowerCase().includes(query);
  const descriptionMatch = item.description && item.description.toLowerCase().includes(query);
  const tagMatch = item.tags && item.tags.some((tag: string) => tag.toLowerCase().includes(query));
  
  return titleMatch || summaryMatch || descriptionMatch || tagMatch;
});
---

<html>
<head>
  <title>æœç´¢æµ‹è¯•</title>
</head>
<body>
  <h1>ğŸ” æœç´¢æµ‹è¯•</h1>
  
  <h2>æœç´¢å‚æ•°</h2>
  <p>æŸ¥è¯¢è¯: <strong>{searchQuery}</strong></p>
  <p>å®Œæ•´ URL: <code>{Astro.url.toString()}</code></p>
  
  <h2>ğŸ“Š æ•°æ®ç»Ÿè®¡</h2>
  <ul>
    <li>æ€»å†…å®¹æ•°é‡: {allContent.length}</li>
    <li>æ–‡ç« æ•°é‡: {allArticles.length}</li>
    <li>è§†é¢‘æ•°é‡: {allVideos.length}</li>
    <li>æœç´¢ç»“æœæ•°é‡: {filteredContent.length}</li>
  </ul>
  
  <h2>ğŸ“‹ æ‰€æœ‰å†…å®¹</h2>
  <ul>
    {allContent.map((item, index) => (
      <li>
        <strong>{index + 1}. {item.title}</strong><br/>
        ç±»å‹: {item.contentType} | æ ‡ç­¾: {item.tags?.join(', ') || 'æ— '}
      </li>
    ))}
  </ul>
  
  <h2>ğŸ¯ æœç´¢ç»“æœ</h2>
  {filteredContent.length > 0 ? (
    <ul>
      {filteredContent.map((item, index) => (
        <li>
          <strong>{index + 1}. {item.title}</strong><br/>
          ç±»å‹: {item.contentType} | æ ‡ç­¾: {item.tags?.join(', ') || 'æ— '}
        </li>
      ))}
    </ul>
  ) : (
    <p>âŒ æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å†…å®¹</p>
  )}
  
  <h2>ğŸ”§ æµ‹è¯•é“¾æ¥</h2>
  <ul>
    <li><a href="/search-test?search=OGSM">æµ‹è¯• OGSM æœç´¢</a></li>
    <li><a href="/search-test?search=æŠ•èµ„">æµ‹è¯• æŠ•èµ„ æœç´¢</a></li>
    <li><a href="/search-test?search=ç†è´¢">æµ‹è¯• ç†è´¢ æœç´¢</a></li>
    <li><a href="/blog?search=OGSM">å†…å®¹ä¸­å¿ƒ OGSM æœç´¢</a></li>
  </ul>
</body>
</html> 